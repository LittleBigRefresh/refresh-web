@if (level && ownUser && !isUserPublisher && !isUserCurator)
{
  <p>You may not edit this level. Go away.</p>
}
@else if (level && ownUser) {
  <div class="flex flex-col gap-y-3">
    <div class="flex flex-row gap-x-2">
      <app-page-title></app-page-title>
      <p class="italic text-gentle content-center">(Level ID: <code>{{ level.levelId }}</code>)</p>
    </div>

    <div class="flex flex-col gap-x-10 gap-y-2.5">
      <div *ngIf="level" class="bg-header-background text-header-foreground p-5 rounded-md flex-grow">
        
        <div class="flex flex-row flex-grow flex-wrap gap-3.5">
          <div class="flex flex-col justify-start">
            <div class="group relative flex justify-center items-center aspect-rounded my-2.5" >
              <app-level-avatar [level]="level" [size]="(layout.isMobile | async) ? 100 : 176" avatar></app-level-avatar>
              <input type="file" (change)="uploadIcon($event).then()" class="hidden" id="pfpInput">
              <label for="pfpInput" class="flex rounded-full bg-[#000000aa] h-full w-full absolute justify-center items-center opacity-0 group-hover:opacity-80 transition-opacity">
                <fa-icon [icon]="faPencil" class="text-4xl"></fa-icon>
              </label>
            </div>
          </div>
          
          <div class="flex flex-col flex-grow gap-y-4">
            <app-textarea label="Title" [showMaxLength]="true" [maxLength]="64" [form]="settingsForm" placeholder="Unnamed Level" ctrlName="title" [icon]="faPencil" (change)="checkTitleChanges()"></app-textarea>
          </div>
        </div>

        <app-textarea class="pt-2" [showMaxLength]="true" [maxLength]="512" label="Description" [form]="settingsForm" placeholder="No description, yet..." ctrlName="description" [icon]="faPencil" (change)="checkDescriptionChanges()"></app-textarea>
      </div>
      
      <div class="flex flex-row justify-between pt-3 gap-x-2">
        <app-button *ngIf="isUserPublisher || isUserModerator" 
        [icon]="faTrash" text="DELETE level" color="bg-red" (click)="deleteButtonClick()"></app-button>
        <div class="flex flex-row flex-grow justify-end">
          <app-button [icon]="faFloppyDisk" text="Save changes" color="bg-primary" [enabled]="hasPendingChangesTotal" (click)="uploadChanges()"></app-button>
        </div>
      </div>
    </div>
    
    @if (isUserCurator) {
      <app-divider></app-divider>

      <div class="flex flex-col gap-y-4">
        <app-page-title title="Admin/Curator Settings"></app-page-title>

        <div class="flex flex-row flex-wrap gap-x-2 gap-y-1 justify-start">
          <p class="w-42 text-2xl content-center">Game version:</p>
          <app-dropdown-menu [showMenu]="showGameMenu" offsets="top-9 -left-5" [width]="64">
            <app-button trigger
              width="flex flex-shrink justify-evenly flex-grow w-48 text-nowrap"
              [text]="curatorForm.controls.gameVersion.getRawValue()! | game"
              [icon]="showGameMenu ? faChevronUp : faChevronDown"
              [color]="gameButtonColor"
              (click)="gameButtonClick()">
            </app-button>
            <div class="" content>
              <app-radio-button [label]="0 | game" [form]="curatorForm" ctrlName="gameVersion" id="g0" [value]='0' (click)="setGame(0)"></app-radio-button>
              <app-radio-button [label]="1 | game" [form]="curatorForm" ctrlName="gameVersion" id="g1" [value]='1' (click)="setGame(1)"></app-radio-button>
              <app-radio-button [label]="2 | game" [form]="curatorForm" ctrlName="gameVersion" id="g2" [value]='2' (click)="setGame(2)"></app-radio-button>
              <app-radio-button [label]="3 | game" [form]="curatorForm" ctrlName="gameVersion" id="g3" [value]='3' (click)="setGame(3)"></app-radio-button>
              <app-radio-button [label]="4 | game" [form]="curatorForm" ctrlName="gameVersion" id="g4" [value]='4' (click)="setGame(4)"></app-radio-button>
              <!-- 5 = Website, which is invalid -->
              <app-radio-button [label]="6 | game" [form]="curatorForm" ctrlName="gameVersion" id="g6" [value]='6' (click)="setGame(6)"></app-radio-button>
            </div>
          </app-dropdown-menu>
        </div>

        <div class="flex flex-col flex-grow max-w-96 max-lg:w-auto gap-y-2.5">
          <div>
            <div class="flex flex-row content-center gap-x-4">
              <app-checkbox label="Team Picked" [form]="curatorForm"  ctrlName="isTeamPicked" [icon]="faCertificate" (change)="checkTeamPickChanges()"></app-checkbox>
              <p *ngIf="level.teamPicked" class="italic text-gentle text-sm font-sm text-grey content-center">
                since <app-date [date]="level.dateTeamPicked"></app-date>
              </p>
            </div>
            <app-checkbox label="Mark as re-upload" [form]="curatorForm" ctrlName="isReupload" [icon]="faClone" (change)="checkIsReuploadChanges()"></app-checkbox>
          </div>

          <app-textbox label="Original Publisher" [showMaxLength]="true" [maxLength]="16" [form]="curatorForm" placeholder="greek-player_50" ctrlName="originalPublisher" [icon]="faUser" (change)="checkOriginalPublisherChanges()"></app-textbox>
        </div>
      </div>
    }
  </div>

  <!-- Deletion prompt overlay -->
  @defer (when showDeletionPrompt) { @if (showDeletionPrompt) {
    <app-dialog class="flex flex-row flex-grow" (onDialogClose)="closeDeleteDialog()">
      <div class="w-full h-full m-5 flex flex-col pr-10">
        <app-page-title title="Are you sure you want to delete this level? This can not be undone!"></app-page-title>
        <div class="flex flex-row gap-x-6 justify-between mt-10">
          <app-button
            text="Yes, Delete!"
            [icon]="faTrash"
            color="bg-red"
            (click)="delete()"
          ></app-button>
          <app-button
            text="No, Go back!"
            [icon]="faSignOutAlt"
            color="bg-secondary"
            (click)="closeDeleteDialog()"
          ></app-button>
        </div>
      </div>
    </app-dialog>
  }}
}
